{% extends "layout.html" %}
{% import 'forms.html' as forms %}

{% block title %}
Algae is an application template for Google App Engine
{% endblock %}

{% block scripts %}
  
{% endblock %}

{% block content %}

<!-- tabbed content !-->
<div class="tabbable"> 
  <ul id="tabs" class="nav nav-tabs">
    <li class="active"> <a href="#users"><h4><i class="icon-user"></i> Users</h4></a></li>
    <li><a href="#api"><h4><i class="icon-cogs"></i> RESTful APIs</h4></a></li>
    <li><a href="#rpc"><h4><i class="icon-cogs"></i> RPC-style APIs</h4></a></li>
    <li><a href="#security"><h4><i class="icon-lock"></i> Security</h4></a></li>
    <li><a href="#css"><h4><i class="icon-tint"></i> CSS/LESS</h4></a></li>
    <li><a href="#test"><h4><i class="icon-fire"></i> Testing</h4></a></li>
    <li class="pull-right"><a href="#about"><h4>About</h4></a></li>
  </ul>
  <div class="tab-content">
    <div class="tab-pane active row" id="users">
      <div class="span12">

        <h4>Profiles</h4>
        <blockquote>
        <code>gae/handlers/oauth.py</code> and <code>gae/handlers/email_auth.py</code> request handlers are responsible for processing OAuth and email user authentication. <br>
        <code>USER_ATTR</code> dictionary in <code>gae/handlers/oauth.py</code> defines how user fields map between different services (identity providers) and the app's internal user model. The rest is a lot of smart Python code you needn't worry about.
        </blockquote>
        {% if logged_in %}
          <p>Signed in as <img style="max-width:100px" src = "{{ current_user.pic }}"> via <a href="{{ current_user.profile }}">{{ current_user.username }}</a>. <a href="/logout">Logout</a>
        {% else %}
          No one is signed in. Sign in with:
          <ul>
            <li><a href="/auth/facebook">Facebook</a>
            <li><a href="/auth/google">Google</a>
            <li><a href="/auth/twitter">Twitter</a>
            <li><a data-toggle="modal" href="#signup">Sign up</a> or <a data-toggle="modal" href="#signin">sign in</a> with email
          </ul>
        {% endif %}
        <h4>Sessions</h4>
        <blockquote>
        Sessions are tracked by encrypted, client-side cookies. <code>COOKIE_TEMPLATE</code> variable in <code>gae/settings.py</code> defines the cookie content, and <code>session</code> dictionary can be accessed in every request handler. 
        </blockquote>
     
        <p>Reload this page. The number of pageviews should increase. 
    
        <p>Pageviews: {{pageviews}}
      </div>
    </div>

    <div class="tab-pane row" id="api">
      <div class="span12" >
        <blockquote>
        Full CRUD access to models is supported via POST, PUT, GET, and DELETE AJAX calls. See <code>gae/static/js/script.js</code> for sample code. The calls are routed via <code>BaseRESTHandler</code> in <code>gae/handlers/common.py</code>
        <br>
        The forms below are automatically generated from model definitions in <code>gae/code/model.py</code>. 
        <code>generate_model_form()</code> in <code>gae/code/model.py</code> converts the model to a dictionary of template variables, and <code>gae/static/templates/forms.html</code> macro generates the corresponding HTML.
        </blockquote>
        <h4>Create Entity</h4>
        <blockquote>
        

        <div class="well">
          <span class="label label-info">Heads up!</span>
          Only logged in users are authorized to create new entities. See Security tab for how to modify these rules for your app.
        </div>
        </blockquote>
        {{ forms.form('create', 'Create', '', form) }}
        
        <h4>Update/Delete Entity</h4>
        <blockquote>
        <div class="well">
          <span class="label label-info">Heads up!</span>
          Only logged in users are authorized to delete entities. See Security tab for how to modify these rules for your app.
        </div>
        </blockquote>
        
        <script id="entity-row" type="text/html">
        <tr>      
          <td data-id=${id}>${id}</td>
          <td>${obj}</td>
          <td>
            <button type="submit" class="btn update_btn" data-id=${id}><i class="icon-edit"></i> Update</button> 
            <button type="submit" class="btn delete_btn" data-id=${id}><i class="icon-trash"></i> Delete</button>
          </td>
        </tr>
        </script>
      
        <table id="entities" class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>ID</th>
              <th class="span9">Summary</th>
              <th class="">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for widget in widgets %}
            <tr>
              <td>{{widget.key().id()}}</td>
              <td>{{widget.str}}</td>
              <td><button type="submit" class="btn update_btn" data-id="{{widget.key().id()}}"><i class="icon-edit"></i> Update</button> 
              <button type="submit" class="btn delete_btn" data-id="{{widget.key().id()}}"><i class="icon-trash"></i> Delete</button></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        
        {{ forms.form('update', 'Update', 'disabled', form) }}
      </div>
    </div>

    <div class="tab-pane row" id="css">
      <div class="span12">

        <p><span class="app-less-verify">If this text appears in blue</span>, then LESS stylesheets are working. 
        <p><code>gae/static/css/less/app.less</code> contains application-specific styles. You can recompile updated styles by running 
        <code>npm run-script less</code> from <code>gae/static</code>
        
        <p>If <code>npm run-script less</code> command fails:</p>
        <ul>
          <li>Install npm.
          <li>Run <code>npm init</code>
          <li>Accept all defaults (keep pressing Enter)
          <li>Run <code>npm install less --save</code> to install LESS
          <li>Run <code>npm run-script less</code> again. 
        </ul>
      </div>
    </div>

    <div class="tab-pane row" id="about">
      <div class="span12" >
        <p class="lead">Algae is designed to get you app running on Google App Engine in less than 3 minutes and 42 seconds. Guaranteed, or your money back.</p>

        <p>Algae integrates de facto industry standards (like Twitter Bootstrap and HTML5 Boilerplate) with features every web app needs (like user management and third-party authentication). It's flexible, functional, and easy to use.</p>

        <p>Here is what you get:<p>

        <ul>
          <li><a href="http://html5boilerplate.com">HTML5 Boilerplate</a></li>
          <li><a href="http://twitter.github.com/bootstrap/index.html">Twitter Bootstrap</a></li>
          <li><a href="http://lesscss.org/">LESS Stylesheets</a> + <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a></li>
          <li>User account framework, including: 
            <ul>
              <li>Twitter authentication</li>
              <li>Facebook authentication</li>
              <li>Email authentication</li>
              <li>Others (<em>Work in progress</em>)</li>
            </ul>
          <li>Plain and RESTful style API bootstrap code:</li>
            <ul>
              <li>Auto-generate HTML forms from GAE data model</li>
              <li>Seamless entity CRUD via AJAX</li>
            </ul>
          <li>jQuery form validation</li>
          <li>Basic testing infrastructure (<em>Work in progress</em>)</li>
          <li>and more..</li>
        </ul>
        
        <p class="lead">Finally, a GAE template to write home about!</p>
      </div>
    </div>

    <div class="tab-pane row" id="security">
      <div class="span12" >
        <p>A Python decorator -- <code>@with_login</code> -- can be used on any method of <code>BaseHandler</code> or <code>BaseAPIHandler</code> (or their subclasses) to prevent unauthenticated users from viewing certain pages or calling APIs. </p>

        For instance, this <a href="/login_only">page</a> can only be viewed after you login.
      </div>
    </div>

    <div class="tab-pane row" id="test">
      <div class="span12" >
        <p>Simply run <code>python tests/testrunner.py /usr/local/google_appengine .</code> from command line to execute unit and API tests. </p> If the above command fails, make sure that <code>webtest</code> and <code>unittest2</code> Python modules are installed. 

      </div>
    </div>
    <div class="tab-pane row" id="rpc">
      <div class="span12" >
        <h4>Change Email Address</h4>
        <blockquote>
        <div class="well">
          <span class="label label-info">Heads up!</span>
          Only logged in users can change their email address. You can <a href="/">login here</a>.
        </div>
        </blockquote>

        <form id="change_email_addr_form" class="form-horizontal" name="change_email_addr">
          <fieldset>
            <div class="control-group">
              <label class="control-label" for="email">Email address</label>
              <div class="controls">
                <input type="text" class="input-xlarge required email" id="email" val="None">
              </div>
            </div>

            <div class="form-actions">
              <button id="change_email_btn" type="submit" class="btn btn-primary"><i class="icon-edit"></i> Change</button> 
              <span class="form_result"></span>
            </div>

          </fieldset>
        </form>

        <h4>Add To Mailing List</h4>
        <form id="signup_mailing_list_form" class="form-horizontal" name="signup_mailing_list">
          <fieldset>
            <div class="control-group">
              <label class="control-label" for="email">Email address</label>
              <div class="controls">
                <input type="text" class="input-xlarge required email" id="email" val="None">
              </div>
            </div>

            <div class="form-actions">
              <button id="signup_mailing_list_btn" type="submit" class="btn btn-primary"><i class="icon-bolt"></i> Sign Up</button> 
              <span class="form_result"></span>
            </div>

          </fieldset>
        </form>
      </div>
    </div>
  </div> <!-- tab-content !-->
</div> <!-- tabbable !-->

<!-- modal popups for email signin/signup !-->
<div class="tri-state modal hide" id="signup">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h4>Sign up with your email address</h4>
  </div>

  <div class="modal-body">
    <form id="signup_form" class="form-horizontal" name="email-signup">
      <fieldset>
        <div class="control-group">
          <label class="control-label" for="username">Username</label>
          <div class="controls">
            <input type="text" class="input-xlarge required" id="username" val="None">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="email">Email address</label>
          <div class="controls">
            <input type="text" class="input-xlarge required email" id="email" val="None">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="password_raw">Password</label>
          <div class="controls">
            <input type="password" class="input-xlarge required" id="password_raw" val="None">
          </div>
        </div>
      </fieldset>
    </form>
    <div class="form_result"></div>
  </div>
  
  <div class="modal-footer">
    <div class="row">
      <div class="btn_container offset2">
        <button id="signup_btn" type="submit" class="btn btn-primary">Sign Up</button> 
      </div>
    </div>
  </div>
</div>

<div class="tri-state modal hide" id="signin">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h4>Sign in</h4>
  </div>

  <div class="modal-body">
     <form class="form-horizontal" name="email-signin">
      <fieldset>
        <div class="control-group">
          <label class="control-label" for="email">Email address</label>
          <div class="controls">
            <input type="text" class="input-xlarge required email" id="email">
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="password">Password</label>
          <div class="controls">
            <input type="password" class="input-xlarge required" id="password">
          </div>
        </div>
      </fieldset>
    </form>
    <div class="form_result"></div>
  </div>

  <div class="modal-footer">
    <div class="row">
      <div class="btn_container offset2">
        <button id="signin_btn" type="submit" class="btn btn-primary">Sign In</button> 
      </div>
    </div>
  </div>
</div>

{% endblock %}
    
